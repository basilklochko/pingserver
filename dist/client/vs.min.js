(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const services_1=require("./services");class VerySimple{constructor(){this.instanceRegistry={},this.wsService=new services_1.WsService(this),this.httpService=new services_1.HttpService(this),this.componentService=new services_1.ComponentService(this),this.sharedService={id:"$SharedService"}}Start(){document.addEventListener("DOMContentLoaded",()=>{this.loadPartials(),this.bootstrap(document)},!1)}bootstrap(e){let t=e.querySelectorAll(Declarations.componentAttr);for(let e=0;e<t.length;e++){let i=t[e].attributes[Declarations.componentAttr.replace("[","").replace("]","")].value,a=new Function("return new "+i);try{a(),this.initComponent(t,i,e)}catch(a){if(t[e].attributes[Declarations.srcAttr]){let a=t[e].attributes[Declarations.srcAttr].value;var r=document.createElement("script");r.type="text/javascript",r.src=a,r.onload=(()=>{this.initComponent(t,i,e)}),document.head.appendChild(r)}else this.initComponent(t,i,e)}}}initComponent(e,t,r){let i=new Function("component","return new "+t)(t);if(i.id=Guid.NewGuid(),e[r].setAttribute(Declarations.prefix+"id",i.id),this.injectServices(i),null!=i.$onComponentLoad){i.$onComponentLoad();for(let e in this.instanceRegistry){var a=this.instanceRegistry[e].instance;"$SharedService"!=a.id&&a.id!=i.id&&this.bindElements(a)}}this.bindElements(i)}injectServices(e){let t=this;for(var r in e)switch(e[r]){case"$SharedService":e[r]=this.sharedService;break;case"$WsService":let i=new services_1.WsService(t);i.caller=e,e[r]=i;break;case"$HttpService":let a=new services_1.HttpService(t);a.caller=e,e[r]=a;break;case"$ComponentService":let n=new services_1.ComponentService(t);n.caller=e,e[r]=n}}loadPartials(){document.querySelectorAll(Declarations.partialAttr).forEach(e=>{this.componentService.getPartial(e.attributes[Declarations.partialAttr.replace("[","").replace("]","")].value).then(t=>{this.processPartial(e,t)})})}renderPartial(e,t){document.querySelectorAll("["+Declarations.targetAttr+"='"+t+"']").forEach(t=>{this.processPartial(t,e)})}processPartial(e,t){if(e.innerHTML="","function"==typeof t.querySelector)e.insertAdjacentHTML("beforeend",t.querySelector("body").innerHTML),this.bootstrap(e);else{let r=document.createElement("pre"),i=document.createTextNode(t);r.appendChild(i),e.appendChild(r)}}bindElements(e){if(null==document.querySelector("["+Declarations.prefix+"id='"+e.id+"']"))return void delete this.instanceRegistry[e.id];let t=document.querySelector("["+Declarations.prefix+"id='"+e.id+"']").getElementsByTagName("*");for(let r=0;r<t.length;r++){let i=this.findElementComponent(t[r]);if(null!=i&&null!=i.attributes[Declarations.prefix+"id"]&&i.attributes[Declarations.prefix+"id"].value==e.id)for(let i=0;i<t[r].attributes.length;i++)t[r].attributes[i].name===Declarations.forAttr&&this.bindFor(e,t[r],i),t[r].attributes[i].name===Declarations.modelAttr&&this.bindModel(e,t[r]),t[r].attributes[i].name===Declarations.hideAttr&&this.bindHide(e,t[r],i),t[r].attributes[i].name===Declarations.disabledAttr&&this.bindDisabled(e,t[r],i),t[r].attributes[i].name===Declarations.classAttr&&this.bindClass(e,t[r],i),0===t[r].attributes[i].name.indexOf(Declarations.eventStart)&&this.bindEvent(e,t[r],i)}}findElementComponent(e){let t=e.parentElement;if(null!=t)return null==t.attributes[Declarations.componentAttr.replace("[","").replace("]","")]?this.findElementComponent(t):t}bindFor(e,t,r){let i=t.attributes[r].value.split(" in "),a=t.getElementsByClassName("vs-for-template"),n="";if(a.length>0)for(n=a[0].innerHTML;t.lastChild!=a[0];)t.removeChild(t.lastChild);if(2===i.length){let r=i[0],a=i[1],s=e[a];if(s.length>0){n.length>0&&(t.insertAdjacentHTML("beforeend",n),Array.prototype.forEach.call(t.getElementsByTagName("*"),e=>{e.removeAttribute(Declarations.boundAttr)})),t.innerHTML="<div vs-for-item>"+(0==n.length?t.innerHTML:n)+"</div>";let e=t.firstElementChild;s.forEach((i,n)=>{var s=e.cloneNode(!0);var l=t.appendChild(s).getElementsByTagName("*");Array.prototype.forEach.call(l,e=>{e.removeAttribute(Declarations.boundAttr),Array.prototype.forEach.call(e.attributes,t=>{if(t.name==Declarations.modelAttr&&Helper.setAttribute(e,Declarations.modelAttr,a,n,r),0==t.name.indexOf(Declarations.eventStart)){let e=Helper.getArgs(t.value),i=e.replace(r,a+"["+n+"]");t.value=t.value.replace(e,i)}t.name==Declarations.disabledAttr&&Helper.setAttribute(e,Declarations.disabledAttr,a,n,r),t.name==Declarations.hideAttr&&Helper.setAttribute(e,Declarations.hideAttr,a,n,r)})})}),e.classList.add("vs-for-template"),e.style.display="none"}}}bindHide(e,t,r){let i=null!=e[t.attributes[r].value.replace("!","")]&&e[t.attributes[r].value.replace("!","")],a=t.attributes[r].value.replace("!","");try{i=new Function("instance","return instance."+a)(e),0==t.attributes[r].value.indexOf("!")&&(i=!i,a=a.replace("!",""))}catch(e){}t.style.display=i?"none":"",this.addToInstanceRegistry(e,a,t)}bindDisabled(e,t,r){let i=null!=e[t.attributes[r].value.replace("!","")]&&e[t.attributes[r].value.replace("!","")],a=t.attributes[r].value.replace("!","");try{i=new Function("instance","return instance."+a)(e),0==t.attributes[r].value.indexOf("!")&&(i=!i,a=a.replace("!",""))}catch(e){}i?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled"),this.addToInstanceRegistry(e,a,t)}bindClass(e,t,r){let i=null!=e[t.attributes[r].value.replace("!","")]&&e[t.attributes[r].value.replace("!","")],a=t.attributes[r].value;e.constructor.name;0==i.length?t.attributes[Declarations.classAttr+"-current"]&&t.classList.remove(t.attributes[Declarations.classAttr+"-current"].value):(t.attributes[Declarations.classAttr+"-current"]&&t.classList.remove(t.attributes[Declarations.classAttr+"-current"].value),i=i.replace("'","").replace("'","").replace('"',"").replace('"',""),t.setAttribute(Declarations.classAttr+"-current",i),t.classList.add(i)),this.addToInstanceRegistry(e,a,t)}bindModel(e,t){if(null==t.attributes[Declarations.modelAttr])return;let r=t.attributes[Declarations.modelAttr].value,i="";0==t.attributes[Declarations.modelAttr].value.indexOf("$SharedService.")?(e=this.sharedService,this.sharedService[t.attributes[Declarations.modelAttr].value.replace("$SharedService.","")]||(this.sharedService[t.attributes[Declarations.modelAttr].value.replace("$SharedService.","")]=""),i="this.sharedService."+r.replace("$SharedService.","")):i=e.constructor.name+"."+r;let a=this.evalModel(e,t.attributes[Declarations.modelAttr].value);null!=t.value?(t.value=a,t.attributes[Declarations.boundAttr]||this.instanceRegistry[e.id]&&this.instanceRegistry[e.id][i.replace(e.constructor.name+".","")]&&this.instanceRegistry[e.id][i.replace(e.constructor.name+".","")].elements.find(e=>e==t)||t.addEventListener("keyup",()=>{this.bindModelValue(e,t,a)},!1)):null!=a&&(t.innerHTML=a),this.addToInstanceRegistry(e,r,t)}evalModel(instance,modelString){if(0==modelString.indexOf("$SharedService."))return eval(modelString.replace("$SharedService.","this.sharedService."));try{let e=new Function("instance","return instance."+modelString);return e(instance)}catch(e){return""}}bindModelValue(e,t,r){t.value!==r&&(this.assignProperty(e,t.attributes[Declarations.modelAttr].value,t.value),this.syncModel(e))}assignProperty(instance,property,value){if(0!=property.indexOf("$SharedService.")){let e=new Function("instance, value","return instance."+property+"=value");return e(instance,value)}eval("this.sharedService."+property.replace("$SharedService.","")+"=value")}bindEvent(e,t,r){if(t.attributes[Declarations.boundAttr])return;let i=e.constructor.name+"."+t.attributes[r].value,a=Helper.getArgs(i);t.addEventListener(t.attributes[r].name.toString().replace(Declarations.eventStart,""),()=>{let i=t.attributes[r].value.replace("("+a+")",""),n=a.split(",");n.forEach((t,r)=>{if(t.length>0)try{let i=new Function("instance","return instance."+t)(e);i&&(n[r]=i)}catch(e){}}),e[i](n.join(",")),this.bindElements(e);for(let e in this.instanceRegistry)for(let t in this.instanceRegistry[e].instance)this.instanceRegistry[e].instance[t].id&&"$SharedService"==this.instanceRegistry[e].instance[t].id&&this.bindElements(this.instanceRegistry[e].instance)},!1),t.setAttribute(Declarations.boundAttr,"")}addToInstanceRegistry(e,t,r){let i=this.instanceRegistry[e.id];t=t.replace("$SharedService.",""),null==i&&(this.instanceRegistry[e.id]={},this.instanceRegistry[e.id].instance=e),null==this.instanceRegistry[e.id][t]&&(this.instanceRegistry[e.id][t]={}),null==this.instanceRegistry[e.id][t].elements&&(this.instanceRegistry[e.id][t].elements=new Array),this.instanceRegistry[e.id][t].elements.find(e=>e==r)||this.instanceRegistry[e.id][t].elements.push(r)}syncModel(e){for(let t in this.instanceRegistry[e.id])"instance"!=t&&this.instanceRegistry[e.id][t].elements.forEach(t=>{this.bindModel(e,t)})}}exports.VerySimple=VerySimple;class Helper{static setAttribute(e,t,r,i,a){e.setAttribute(t,r+"["+i+"]"+e.attributes[t].value.replace(a,""))}static getArgs(e){return e.substr(e.lastIndexOf("(")+1,e.lastIndexOf(")")-e.lastIndexOf("(")-1)}}exports.Helper=Helper;class Declarations{}Declarations.prefix="vs-",Declarations.eventStart=Declarations.prefix+"event-",Declarations.boundAttr=Declarations.prefix+"bound",Declarations.partial="partial",Declarations.partialAttr="["+Declarations.prefix+Declarations.partial+"]",Declarations.component="component",Declarations.componentAttr="["+Declarations.prefix+Declarations.component+"]",Declarations.forAttr=Declarations.prefix+"for",Declarations.forLoadedAttr=Declarations.prefix+"for-loaded",Declarations.modelAttr=Declarations.prefix+"model",Declarations.hideAttr=Declarations.prefix+"hide",Declarations.disabledAttr=Declarations.prefix+"disabled",Declarations.classAttr=Declarations.prefix+"class",Declarations.targetAttr=Declarations.prefix+"target",Declarations.srcAttr=Declarations.prefix+"src",exports.Declarations=Declarations;class Guid{static NewGuid(){let e=(new Date).getTime();return Date.now&&(e=Date.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)})}}exports.Guid=Guid,(new VerySimple).Start();

},{"./services":2}],2:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class WsService{constructor(e){this.ws=null,this.initiator=e}init(e){this.ws=new WebSocket(e)}send(e){this.ws.send(e)}listen(e){const t=this;this.ws.onmessage=function(s){t.initiator.initialLoad=!0,e(s)}}bindElements(){this.initiator.bindElements(this.caller)}}exports.WsService=WsService;class HttpService{constructor(e){this.initiator=e}getJson(e,t=null){return new Promise((t,s)=>{let i=new XMLHttpRequest;i.onload=(()=>{t(i.response),this.initiator.initialLoad=!0,setTimeout(()=>this.initiator.bindElements(this.caller),100)}),i.onerror=(()=>s(i.statusText)),i.open("GET",e),i.responseType="json",i.send()})}getText(e){return new Promise((t,s)=>{let i=new XMLHttpRequest;i.onload=(()=>t(i.response)),i.onerror=(()=>s(i.statusText)),i.open("GET",e),i.responseType="text",i.send()})}}exports.HttpService=HttpService;class ComponentService{constructor(e){this.initiator=e}renderPartial(e,t){return new Promise((s,i)=>{this.getPartial(e).then(e=>{this.initiator.renderPartial(e,t),s(!0)})})}renderText(e,t){this.initiator.renderPartial(e,t)}getPartial(e){return new Promise((t,s)=>{let i=new XMLHttpRequest;i.onload=(()=>t(i.response)),i.onerror=(()=>s(i.statusText)),i.open("GET",e),i.responseType="document",i.send()})}}exports.ComponentService=ComponentService;

},{}]},{},[1]);
